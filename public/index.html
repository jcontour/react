<!DOCTYPE html>
<html>
<head>
	<title>React</title>
	<meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
	<link rel="stylesheet" href="css/normalize.min.css">
	<link rel="stylesheet" href="css/style.css">

	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	
	<style>
        .axis path {
            fill: none;
            stroke: #777;
            shape-rendering: crispEdges;
        }
        .axis text {
            font-family: Lato;
            font-size: 13px;
        }
    </style>

</head>
<body>

	<div id="main-container"></div>
	<!-- Templates -->
	
	<!-- Lobby -->
	<script id="tpl-lobby" type="text/html">
		
		<h1>Current Reactions</h1>

		<!-- List of reactions -->
		<div id="list-container">
			<!-- Loop through rooms here -->
			<% for(var roomId in data){ %>
				<div class="room-item">
					<a class="body-main" href="#/room/<%= roomId %>">
						<%= data[roomId].name %>
					</a>
					<div class="body-aux">
						(<%= data[roomId].members %> users)
					</div>
				</div>
			<% } %>
		</div>

		<!-- Input -->
		<div id="chat-input">
			<div>
				<input type="text" id="js-ipt-room-name" placeholder="Create a new reaction">
			</div>
			<div>
				<button id="js-btn-create-room">CREATE</button>
			</div>
		</div>		

	</script>

	<!-- Chatroom -->
	<script id="tpl-room" type="text/html">
		<a href="#/lobby" id="js-btn-exit-room">< Back to Lobby</a>		

		<h1>
			<%= data.name %>
		</h1>
		
		<div class="reaction-container">
			<div id="graph"> </div>
		</div>

		<div id="vote-inputs">
				<button id="js-btn-send-yay">YAY</button>
				<button id="js-btn-send-nay">NAY</button>
				<button id="js-btn-send-poop">POOP</button>
				<button id="js-btn-send-wtf">WTF</button>
				<button id="js-btn-send-uh">UH</button>
		</div>

	</script>

	<!-- Graph -->
	<script id="tpl-graph" type="text/html">
<!-- 		<% console.log(data) %> -->
		<ul id="graph">
			<li id="yay"> YAY: <%= data["yay"].length %> </li>
			<li id="nay"> NAY: <%= data["nay"].length %> </li>
			<li id="poop"> POOP: <%= data["poop"].length %> </li>
			<li id="wtf"> WTF: <%= data["wtf"].length %> </li>
			<li id="uh"> UH:  <%= data["uh"].length %> </li>
		</ul>

		<svg id="visualisation" width="500" height="350"></svg>

	<script>

	function InitChart() {

		var yas = [
			<%= data["yay"].length %>
			];
		console.log ("is yay working?");

		var nas = d3.select("#nay");
		var poos = d3.select("#poos");
		var whatthefucks = d3.select("#whatthefucks");
		var uhhhhs = d3.select("#uhhhhs");


		// var nas = <% data["nay"].length %>
		// var poos = <% data["poop"].length %>
		// var whatthefucks = <% data["wtf"].length %>
		// var uhhhhs = <% data["uh"].length %>


		var vis = d3.select("#visualisation"),
    	WIDTH = 400,
    	HEIGHT = 250,
   		MARGINS = {
        	top: 20,
        	right: 20,
        	bottom: 20,
        	left: 50
    	},

    	xScale = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([0, 240]),

    	yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([0,5]),

    	xAxis = d3.svg.axis()
    	.scale(xScale),

    	yAxis = d3.svg.axis()
    	.scale(yScale)
    	.orient("left");

    	vis.append("svg:g")
    	.attr("class", "x axis")
    	.attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
    	.call(xAxis);

    	vis.append("svg:g")
    	.attr("class", "y axis")
    	.attr("transform", "translate(" + (MARGINS.left) + ",0)")
    	.call(yAxis);

    	var lineGen = d3.svg.line()
    	.x(function(d) {
    		return xScale(d.minutes);
    	})
    	.y(function(d) {
    		return yScale(d.people);
    	})
    	.interpolate("basis");


  		vis.append('svg:path')
  			.attr('d', lineGen(yas))
  			.attr('stroke', 'green')
  			.attr('stroke-width', 3)
  			.attr('fill', 'none');
  		console.log("drawing?")	
  		
  		vis.append('svg:path')
  			.attr('d', lineGen(nas))
  			.attr('stroke', 'blue')
  			.attr('stroke-width', 2)
  			.attr('fill', 'none');

   		vis.append('svg:path')
  			.attr('d', lineGen(poos))
  			.attr('stroke', 'red')
  			.attr('stroke-width', 2)
  			.attr('fill', 'none');

   		vis.append('svg:path')
  			.attr('d', lineGen(whatthefucks))
  			.attr('stroke', 'yellow')
  			.attr('stroke-width', 2)
  			.attr('fill', 'none');

  		vis.append('svg:path')
  			.attr('d', lineGen(uhhhhs))
  			.attr('stroke', 'orange')
  			.attr('stroke-width', 2)
  			.attr('fill', 'none');

	}
	InitChart();
    
    </script>


	</script>

	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="js/jquery-min.js"></script>
	<script type="text/javascript" src="js/underscore-min.js"></script>
	<script type="text/javascript" src="js/moment.min.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
</body>
</html>
